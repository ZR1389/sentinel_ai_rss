<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Geocoding Dashboard</title>
  <style>
    :root {
      --bg: #0f172a; /* slate-900 */
      --panel: #111827; /* gray-900 */
      --card: #1f2937; /* gray-800 */
      --text: #e5e7eb; /* gray-200 */
      --muted: #9ca3af; /* gray-400 */
      --accent: #38bdf8; /* sky-400 */
      --ok: #34d399; /* emerald-400 */
      --warn: #fbbf24; /* amber-400 */
      --err: #f87171; /* red-400 */
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); }
    .container { max-width: 1100px; margin: 0 auto; padding: 24px; }
    h1 { font-size: 22px; margin: 0 0 16px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; }
    .card { background: var(--card); border-radius: 10px; padding: 16px; box-shadow: 0 1px 2px rgba(0,0,0,.2); }
    .k { color: var(--muted); font-size: 12px; text-transform: uppercase; letter-spacing: .08em; }
    .v { font-size: 28px; font-weight: 700; margin-top: 6px; }
    .row { display: flex; gap: 16px; }
    .badge { display: inline-block; padding: 4px 8px; border-radius: 999px; font-size: 12px; font-weight: 600; }
    .ok { background: rgba(52,211,153,.15); color: var(--ok); }
    .warn { background: rgba(251,191,36,.15); color: var(--warn); }
    .err { background: rgba(248,113,113,.15); color: var(--err); }
    .bar { height: 10px; background: #111827; border-radius: 999px; overflow: hidden; margin-top: 8px; }
    .bar > div { height: 100%; background: var(--accent); }
    table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    th, td { text-align: left; padding: 8px; font-size: 14px; }
    th { color: var(--muted); font-weight: 600; }
    tr:nth-child(odd) td { background: rgba(255,255,255,0.02); }
    .muted { color: var(--muted); }
    .footer { margin-top: 20px; color: var(--muted); font-size: 12px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Geocoding Dashboard</h1>

    <div class="grid">
      <div class="card">
        <div class="k">Coverage</div>
        <div class="v">{{ coverage.pct_covered or 0 }}%</div>
        <div class="bar"><div style="width: {{ coverage.pct_covered or 0 }}%"></div></div>
        <div class="muted" style="margin-top:8px">
          {{ coverage.with_coords | default(0) | int | string }} / {{ coverage.total_alerts | default(0) | int | string }} with coordinates
        </div>
        {% if coverage.target_reached %}
          <span class="badge ok">Target Reached</span>
        {% else %}
          <span class="badge warn">Below Target</span>
        {% endif %}
      </div>

      <div class="card">
        <div class="k">Backlog</div>
        <div class="v">{{ coverage.backlog | default(0) }}</div>
        {% if coverage.is_cleared %}
          <span class="badge ok">Cleared</span>
        {% else %}
          <span class="badge warn">Processing</span>
        {% endif %}
        <div class="muted" style="margin-top:8px">Cache size: {{ coverage.cache_size | default(0) }}</div>
      </div>

      <div class="card">
        <div class="k">OpenCage Quota</div>
        <div class="v">{{ quota.requests_today }}/{{ quota.daily_limit }}</div>
        <div class="bar"><div style="width: {{ (100 * quota.requests_today / (quota.daily_limit or 1)) | round(1) }}%"></div></div>
        <div class="muted" style="margin-top:8px">Remaining: {{ quota.remaining }} â€¢ Resets in {{ quota.reset_in_seconds }}s</div>
      </div>

      <div class="card">
        <div class="k">Queue Depth</div>
        {% if queue %}
          <table>
            <tr><th>Queued</th><td>{{ queue.queued }}</td></tr>
            <tr><th>Started</th><td>{{ queue.started }}</td></tr>
            <tr><th>Scheduled</th><td>{{ queue.scheduled }}</td></tr>
            <tr><th>Deferred</th><td>{{ queue.deferred }}</td></tr>
            <tr><th>Failed</th><td>{{ queue.failed }}</td></tr>
            <tr><th>Inflight Dedup</th><td>{{ queue.inflight_dedup }}</td></tr>
          </table>
        {% else %}
          <div class="muted">Redis not configured</div>
        {% endif %}
      </div>
    </div>

    <div class="footer">Updated: {{ (namespace().now if false else '') }} <!-- simple static view; refresh to update --></div>
  </div>
</body>
</html>
